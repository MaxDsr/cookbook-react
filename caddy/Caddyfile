# Caddyfile for production
# Main site serves static files and proxies API requests
# MinIO subdomain handles object storage requests

# Main application domain
:80 {
    # Handle API requests - proxy to backend
    handle /api/* {
        reverse_proxy host.docker.internal:{$BACKEND_PORT}
    }
    
    # Handle everything else - serve static files
    handle {
        root * /srv
        try_files {path} /index.html
        file_server
    }

    encode gzip
    
    log {
        output stdout
        format console
    }
}

# MinIO subdomain for object storage
# Note: Requires DNS A record: minio.yourdomain.com â†’ your-server-ip
# In production, configure with your actual domain instead of :80
minio.yourdomain.com {
    reverse_proxy minio:9000
    
    encode gzip
    
    log {
        output stdout
        format console
    }
}

